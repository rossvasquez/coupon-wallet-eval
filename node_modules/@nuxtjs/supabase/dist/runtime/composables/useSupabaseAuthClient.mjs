import { createClient } from "@supabase/supabase-js";
import { defu } from "defu";
import { useSupabaseToken } from "./useSupabaseToken.mjs";
import { useRuntimeConfig, useNuxtApp } from "#imports";
export const useSupabaseAuthClient = () => {
  const nuxtApp = useNuxtApp();
  if (!nuxtApp._supabaseAuthClient) {
    const token = useSupabaseToken();
    const authorizationHeader = token.value ? `Bearer ${token.value}` : void 0;
    const { supabase: { url, key, client: clientOptions } } = useRuntimeConfig().public;
    const options = authorizationHeader ? defu(clientOptions, { global: { headers: { Authorization: authorizationHeader } } }) : clientOptions;
    nuxtApp._supabaseAuthClient = createClient(url, key, options);
  }
  return nuxtApp._supabaseAuthClient;
};
